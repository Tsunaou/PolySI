## Build

PolySI is tested on Ubuntu 22.04 LTS. Follow the instructions below to build it.

```
$ sudo apt update
$ sudo apt install g++ openjdk-11-jdk cmake libgmp-dev zlib1g-dev
$ git clone --recurse-submodules https://github.com/amnore/PolySI
$ cd PolySI
$ ./gradlew jar
```

## Usage

After building, there should be a jar file in the `build/libs` directory. Use
this file to run the program.

To verify histories, use the `audit` command:

```
$ java -jar PolySI/build/libs/PolySI-1.0.0-SNAPSHOT.jar audit --help
Usage: verifier audit [-hV] [--no-coalescing] [--no-pruning] [-t=<type>] <path>
      <path>            history path
  -h, --help            Show this help message and exit.
      --no-coalescing   disable coalescing
      --no-pruning      disable pruning
  -t, --type=<type>     history type: COBRA, DBCOP, TEXT
  -V, --version         Print version information and exit.
```

Histories to reproduce the results are in
[PolySIHistories](https://github.com/amnore/PolySIHistories.git).

There are three kinds of histories PolySI can accept:

### Histories generated by [Cobra](https://github.com/DBCobra/CobraBench)

This kind of histories contains files like `T*.log` in a directory. To verify
them, pass `--type=cobra` to this program:

```
$ java -jar PolySI/build/libs/PolySI-1.0.0-SNAPSHOT.jar audit --type=cobra PolySIHistories/fig8_9_10/rubis-10000/hist-00000
```

### Histories generated by [DBCop](https://github.com/amnore/dbcop)

These histories are stored in a single file named `history.bincode`. Use
`--type=dbcop` with the `audit` command:

```
$ java -jar PolySI/build/libs/PolySI-1.0.0-SNAPSHOT.jar audit --type=dbcop PolySIHistories/fig8_9_10/25_400_8_10000_0.3_uniform/hist-00000/history.bincode
```

### Text format

These histories are stored in a text file. Each operation occupies one line,
with the following format:

```
# r means read, w means write
<r/w>(<key>,<value>,<session_id>,<transaction_id>)
```

Use `--type=text` with this kind of histories:

```
$ java -jar PolySI/build/libs/PolySI-1.0.0-SNAPSHOT.jar audit --type=text PolySIHistories/violations/galera/galera.txt
```
